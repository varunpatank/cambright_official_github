// v0.0.01 salah

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
  previewFeatures = []
}

model Course {
  id           String    @id @default(uuid()) 
  userId       String
  title        String    @db.VarChar(255) 
  description  String?   @db.Text         
  imageUrl     String?   @db.Text         
  isPublished  Boolean   @default(false)
  subjectId   String?
  boardId   String?
  subject     Subject? @relation(fields: [subjectId], references: [id])
  board     Board? @relation(fields: [boardId], references: [id])
  chapters Chapter[]
  attachments  Attachment[]
  enrollment Enrollment[]
  sessionlink  String? 
  sessiondate  String?
  sessiontime  String? 
  attachmentLink String?
  
  // Asset reference
  imageAssetKey String?
  imageAsset    AssetManager? @relation("CourseImageAsset", fields: [imageAssetKey], references: [key])
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  @@index([subjectId])
  @@index([boardId])
  @@index([userId])
  @@index([isPublished])
  @@index([createdAt])
  @@index([imageAssetKey])
}

model Subject {
  id       String    @id @default(uuid()) 
  name     String    @unique
  courses  Course[]
}

model Board {
  id       String    @id @default(uuid()) 
  name     String    @unique
  courses  Course[]
}

model Attachment {
  id         String    @id @default(uuid()) 
  name       String
  url        String    @db.Text        

  courseId   String
  course     Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  @@index([courseId])
}

model Chapter {
  id String @id @default(uuid())
  title String
  description String? @db.Text
  videoUrl String? @db.Text
  videoAssetKey String? // Asset Manager key for video
  position Int
  isPublished Boolean @default(false)

  sessionlink  String? 
  sessiondate  String?
  sessiontime  String? 
  
  cloudinaryData CloudinaryData?

  courseId String
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  userProgress UserProgress[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([courseId])
  @@index([isPublished])
  @@index([position])
  @@index([courseId, position])
}
model CloudinaryData{
  id String @id @default(uuid())
  assetId String
  playbackId String?
  publicId  String 
  videoUrl  String 
  chapterId String @unique
  chapter Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model UserProgress{
  id String @id @default(uuid())
  userId String
  chapterId String @unique
  chapter Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  isCompleted Boolean @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  @@index([chapterId])
  @@index([userId])
  @@index([userId, isCompleted])
  @@unique([userId, chapterId])
}

model Enrollment{
  id String @id @default(uuid())
  userId String

  courseId String
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  @@unique([userId, courseId])
  @@index([courseId])
  @@index([userId])
  @@index([createdAt])
}

model Profile {
  id        String  @unique @id @default(uuid())
  userId    String   @unique
  name      String
  imageUrl  String
  email     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  rooms     Room[]
  members   Member[]
  chats     Chat[]
}


model Room {
  id          String   @id @default(uuid())
  name        String
  imageUrl    String
  inviteCode  String @unique
  profileId   String
  profile     Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  members     Member[]
  chats       Chat[]
     
  @@index([profileId])
}

model Member {
  id        String     @id @default(uuid())
  role      MemberRole @default(GUEST)
  roomId    String
  room      Room       @relation(fields: [roomId], references: [id], onDelete: Cascade)
  profileId String
  profile   Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)
  messages Message[]
  directMessages DirectMessage[]

  conversationsInitiated Conversation[] @relation("MemberOne")
  conversationsRecieved Conversation[] @relation("MemberTwo")

  @@index([profileId])
  @@index([roomId])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MemberRole {
  ADMIN
  MODERATOR
  GUEST
}

model Chat {
  id        String   @id @default(uuid())
  name      String
  type      ChatType @default(TEXT)
  roomId    String
  room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  messages Message[]
  @@index([profileId])
  @@index([roomId])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ChatType {
  TEXT
  AUDIO
  VIDEO
}
model Message{
  id String @id @default(uuid())
  content String
  fileUrl String?
  memberId String
  member   Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  chatId String
  chat   Chat    @relation(fields: [chatId], references: [id], onDelete: Cascade)
  deleted Boolean @default(false)
  @@index([chatId])
  @@index([memberId])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Conversation{
  id String @id @default(uuid())
  memberOneId String
  memberOne  Member @relation("MemberOne", fields: [memberOneId], references: [id], onDelete: Cascade)
  memberTwoId String
  memberTwo  Member @relation("MemberTwo", fields: [memberTwoId], references: [id], onDelete: Cascade)
  @@index([memberTwoId])
  @@unique([memberOneId, memberTwoId])
  directMessages DirectMessage[]
}
model DirectMessage{
  id String @id @default(uuid())
  content String
  fileUrl String?
  memberId String
  member   Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  conversationId String
  conversation   Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  deleted Boolean @default(false)
  @@index([conversationId])
  @@index([memberId])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Tutor {
  id        String   @id @default(uuid())
  userId    String   @unique  // Clerk user ID
  isActive  Boolean  @default(true)
  role      TutorRole @default(TUTOR)
  addedBy   String   // User ID who added this tutor
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Audit log
  auditLogs TutorAuditLog[]
  
  @@index([userId])
  @@index([isActive])
}

model TutorAuditLog {
  id          String   @id @default(uuid())
  tutorId     String
  tutor       Tutor    @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  action      String   // "ADDED", "REMOVED", "ACTIVATED", "DEACTIVATED"
  performedBy String   // User ID who performed the action
  details     Json?    // Additional context
  createdAt   DateTime @default(now())
  
  @@index([tutorId])
  @@index([createdAt])
}

enum TutorRole {
  TUTOR
  SENIOR_TUTOR
  ADMIN_TUTOR
}

model Note {
  id           String    @id @default(uuid()) 
  userId       String
  title        String    @db.VarChar(255) 
  description  String?   @db.Text         
  imageUrl     String?   @db.Text         
  notesubjectId   String?
  isPublished  Boolean   @default(false)
  noteboardId   String?
  notesubject     NoteSubject? @relation(fields: [notesubjectId], references: [id])
  noteboard     NoteBoard? @relation(fields: [noteboardId], references: [id])
  notechapters NoteChapter[]
  noteattachments  NoteAttachment[]
  added Added[]
  sessionlink  String? 
  sessiondate  String?
  sessiontime  String? 
  attachmentLink String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  @@index([notesubjectId])
  @@index([noteboardId])
  @@index([userId])
  @@index([isPublished])
  @@index([createdAt])
}
model NoteAttachment {
  id         String    @id @default(uuid()) 
  name       String
  url        String    @db.Text        

  noteId   String
  note     Note    @relation(fields: [noteId], references: [id], onDelete: Cascade)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  @@index([noteId])
}
model NoteSubject {
  id       String    @id @default(uuid()) 
  name     String    @unique
  notes  Note[]
}

model NoteBoard {
  id       String    @id @default(uuid()) 
  name     String    @unique
  notes  Note[]
}

model Added{
  id String @id @default(uuid())
  userId String

  noteId String
  note Note @relation(fields: [noteId], references: [id], onDelete: Cascade)

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  @@unique([userId, noteId])
  @@index([noteId])
}

model NoteCloudinaryData{
  id String @id @default(uuid())
  assetId String
  playbackId String?
  publicId  String 
  videoUrl  String 
  notechapterId String @unique
  notechapter NoteChapter @relation(fields: [notechapterId], references: [id], onDelete: Cascade)
}

model NoteUserProgress{
  id String @id @default(uuid())
  userId String
  notechapterId String @unique
  notechapter NoteChapter @relation(fields: [notechapterId], references: [id], onDelete: Cascade)

  isCompleted Boolean @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  @@index([notechapterId])
  @@unique([userId, notechapterId])
}
model NoteChapter {
  id String @id @default(uuid())
  title String
  description String? @db.Text
  videoUrl String? @db.Text
  videoAssetKey String? // Asset Manager key for video
  position Int
  isPublished Boolean @default(false)

  sessionlink  String? 
  sessiondate  String?
  sessiontime  String? 
  
  cloudinaryData NoteCloudinaryData?

  noteId String
  note Note @relation(fields: [noteId], references: [id], onDelete: Cascade)

  noteuserProgress NoteUserProgress[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([noteId])
}
model UserModel {
  id String @id @default(uuid())
  userId    String  @unique
  name      String 
  imageUrl  String
  email     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  followers Int      @default(0)
  following Int      @default(0)
  biog      String
  XP        Int      @default(5)
  tags      Tag[]    @relation("UserTags")
  
  // Define a one-to-many relationship for followers (inverse relation for `Follow` model)
  followedBy Follow[] @relation("FollowedBy")
  
  // Define a one-to-many relationship for following (inverse relation for `Follow` model)
  followingUsers Follow[] @relation("Following")
}

model Follow {
  id        String   @id @default(uuid())
  followerId String
  followedId String
  
  // Relationships to the User model
  follower  UserModel @relation("Following", fields: [followerId], references: [id])
  followed  UserModel @relation("FollowedBy", fields: [followedId], references: [id])

  // Prevent duplicate follows by making the pair of follower and followed unique
  @@unique([followerId, followedId])
}

model Tag {
  id    String   @id @default(uuid())
  name  String  
  users UserModel[] @relation("UserTags")
}


model Sprint {
  id            String   @id @default(uuid())
  orgId         String
  title         String
  imageId       String
  imageThumbUrl String
  imageFullUrl  String
  imageUserName String
  imageLinkHTML String
  isTemplate    Boolean  @default(false) 
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lists         List[]
}
model List {
  id        String   @id @default(uuid())
  title     String
  order     Int
  sprintId   String
  sprint     Sprint    @relation(fields: [sprintId], references: [id], onDelete: Cascade)
  tasks     Task[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sprintId])
}

model Task {
  id          String   @id @default(uuid())
  title       String
  order       Int
  description String?  @db.Text
  listId      String
  list        List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  dueDate     DateTime?
  @@index([listId])
}

enum ACTION {
  CREATE
  UPDATE
  DELETE
}

enum ENTITY_TYPE {
  SPRINT
  LIST
  TASK
}

model AuditLog {
  id          String      @id @default(uuid())
  orgId       String
  action      ACTION
  entityId    String
  entityType  ENTITY_TYPE
  entityTitle String
  userId      String
  userImage   String      @db.Text
  userName    String      @db.Text
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model School {
  id             String        @id @default(uuid())
  name           String
  description    String?       @db.Text
  imageUrl       String?       @db.Text
  location       String?
  website        String?
  email          String?
  phone          String?
  isActive       Boolean       @default(true)
  volunteerHours Int           @default(0)
  activeMembers  Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  createdBy      String
  
  // Asset references
  imageAssetKey    String?
  bannerAssetKey   String?
  imageAsset       AssetManager? @relation("SchoolImageAsset", fields: [imageAssetKey], references: [key])
  bannerAsset      AssetManager? @relation("SchoolBannerAsset", fields: [bannerAssetKey], references: [key])
  
  // Relations
  posts          SchoolPost[]
  chapterAdmins  ChapterAdmin[]

  @@index([isActive])
  @@index([createdAt])
  @@index([volunteerHours])
}

model SchoolPost {
  id          String      @id @default(uuid())
  schoolId    String
  school      School      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  title       String
  content     String      @db.Text
  imageUrl    String?     @db.Text
  authorId    String
  authorName  String
  postType    PostType    @default(ANNOUNCEMENT)
  isActive    Boolean     @default(true)
  
  // Asset reference
  imageAssetKey String?
  imageAsset    AssetManager? @relation("PostImageAsset", fields: [imageAssetKey], references: [key])
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([schoolId])
  @@index([isActive])
  @@index([createdAt])
}

enum PostType {
  ANNOUNCEMENT
  EVENT
}

model AssetManager {
  id          String      @id @default(uuid())
  key         String      @unique  // Public-facing unique key
  fileName    String      // Original filename
  mimeType    String      // File MIME type
  fileSize    Int         // File size in bytes
  minioPath   String      // Internal MinIO path
  uploadedBy  String      // User ID who uploaded
  assetType   AssetType   // Type of asset
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations to entities using this asset
  schoolImages    School[]     @relation("SchoolImageAsset")
  schoolBanners   School[]     @relation("SchoolBannerAsset") 
  postImages      SchoolPost[] @relation("PostImageAsset")
  courseImages    Course[]     @relation("CourseImageAsset")
  
  @@index([key])
  @@index([assetType])
  @@index([uploadedBy])
}

enum AssetType {
  SCHOOL_IMAGE
  SCHOOL_BANNER
  POST_IMAGE
  COURSE_IMAGE
  CHAPTER_VIDEO
  NOTE_ATTACHMENT
}

model ChapterAdmin {
  id          String              @id @default(uuid())
  userId      String              // Clerk user ID
  schoolId    String
  school      School              @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  role        ChapterAdminRole    @default(CHAPTER_ADMIN)
  assignedBy  String              // User ID who assigned this role
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  
  @@unique([userId, schoolId])
  @@index([userId])
  @@index([schoolId])
  @@index([role])
}

enum ChapterAdminRole {
  CHAPTER_ADMIN
  CHAPTER_SUPER_ADMIN
}


generator client {
  provider        = "prisma-client-js"
  previewFeatures = []
  binaryTargets   = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Course {
  id             String       @id @default(uuid())
  userId         String
  title          String       @db.VarChar(255)
  description    String?
  imageUrl       String?
  isPublished    Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  subjectId      String?
  sessionlink    String?
  sessiondate    String?
  sessiontime    String?
  attachmentLink String?
  boardId        String?
  imageAssetId   String?
  attachments    Attachment[]
  chapters       Chapter[]
  board          Board?       @relation(fields: [boardId], references: [id])
  Assets         Assets?      @relation(fields: [imageAssetId], references: [id])
  subject        Subject?     @relation(fields: [subjectId], references: [id])
  enrollment     Enrollment[]

  @@index([subjectId])
  @@index([boardId])
  @@index([userId])
  @@index([isPublished])
  @@index([createdAt])
}

model Subject {
  id      String   @id @default(uuid())
  name    String   @unique
  courses Course[]
}

model Board {
  id      String   @id @default(uuid())
  name    String   @unique
  courses Course[]
}

model Attachment {
  id        String   @id @default(uuid())
  name      String
  url       String
  courseId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
}

model Chapter {
  id             String          @id @default(uuid())
  title          String
  description    String?
  videoUrl       String?
  position       Int
  isPublished    Boolean         @default(false)
  sessionlink    String?
  sessiondate    String?
  sessiontime    String?
  courseId       String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  videoAssetKey  String?
  course         Course          @relation(fields: [courseId], references: [id], onDelete: Cascade)
  cloudinaryData CloudinaryData?
  userProgress   UserProgress?

  @@index([courseId])
  @@index([isPublished])
  @@index([position])
  @@index([courseId, position])
}

model CloudinaryData {
  id         String  @id @default(uuid())
  assetId    String
  playbackId String?
  publicId   String
  videoUrl   String
  chapterId  String  @unique
  chapter    Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model UserProgress {
  id          String   @id @default(uuid())
  userId      String
  chapterId   String   @unique
  isCompleted Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  chapter     Chapter  @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  @@unique([userId, chapterId])
  @@index([chapterId])
  @@index([userId])
  @@index([userId, isCompleted])
}

model Enrollment {
  id        String   @id @default(uuid())
  userId    String
  courseId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId])
  @@index([userId])
  @@index([createdAt])
}

model Profile {
  id        String   @id @unique @default(uuid())
  userId    String   @unique
  name      String
  imageUrl  String
  email     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  chats     Chat[]
  members   Member[]
  rooms     Room[]
}

model Room {
  id         String   @id @default(uuid())
  name       String
  imageUrl   String
  inviteCode String   @unique
  profileId  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  chats      Chat[]
  members    Member[]
  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Member {
  id                     String          @id @default(uuid())
  role                   MemberRole      @default(GUEST)
  roomId                 String
  profileId              String
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  conversationsInitiated Conversation[]  @relation("MemberOne")
  conversationsRecieved  Conversation[]  @relation("MemberTwo")
  directMessages         DirectMessage[]
  profile                Profile         @relation(fields: [profileId], references: [id], onDelete: Cascade)
  room                   Room            @relation(fields: [roomId], references: [id], onDelete: Cascade)
  messages               Message[]

  @@index([profileId])
  @@index([roomId])
}

model Chat {
  id        String    @id @default(uuid())
  name      String
  type      ChatType  @default(TEXT)
  roomId    String
  profileId String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  room      Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)
  messages  Message[]

  @@index([profileId])
  @@index([roomId])
}

model Message {
  id        String   @id @default(uuid())
  content   String
  fileUrl   String?
  memberId  String
  chatId    String
  deleted   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([chatId])
  @@index([memberId])
}

model Conversation {
  id             String          @id @default(uuid())
  memberOneId    String
  memberTwoId    String
  memberOne      Member          @relation("MemberOne", fields: [memberOneId], references: [id], onDelete: Cascade)
  memberTwo      Member          @relation("MemberTwo", fields: [memberTwoId], references: [id], onDelete: Cascade)
  directMessages DirectMessage[]

  @@unique([memberOneId, memberTwoId])
  @@index([memberTwoId])
}

model DirectMessage {
  id             String       @id @default(uuid())
  content        String
  fileUrl        String?
  memberId       String
  conversationId String
  deleted        Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  member         Member       @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([memberId])
}

model Tutor {
  id        String          @id @default(uuid())
  userId    String          @unique
  addedBy   String
  createdAt DateTime        @default(now())
  isActive  Boolean         @default(true)
  role      TutorRole       @default(TUTOR)
  updatedAt DateTime        @updatedAt
  auditLogs TutorAuditLog[]

  @@index([userId])
  @@index([isActive])
}

model TutorAuditLog {
  id          String   @id @default(uuid())
  tutorId     String
  action      String
  performedBy String
  details     Json?
  createdAt   DateTime @default(now())
  tutor       Tutor    @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@index([createdAt])
}

model Note {
  id              String           @id @default(uuid())
  userId          String
  title           String           @db.VarChar(255)
  description     String?
  imageUrl        String?
  notesubjectId   String?
  noteboardId     String?
  sessionlink     String?
  sessiondate     String?
  sessiontime     String?
  attachmentLink  String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  isPublished     Boolean          @default(false)
  added           Added[]
  noteboard       NoteBoard?       @relation(fields: [noteboardId], references: [id])
  notesubject     NoteSubject?     @relation(fields: [notesubjectId], references: [id])
  noteattachments NoteAttachment[]
  notechapters    NoteChapter[]

  @@index([notesubjectId])
  @@index([noteboardId])
  @@index([userId])
  @@index([isPublished])
  @@index([createdAt])
}

model NoteAttachment {
  id        String   @id @default(uuid())
  name      String
  url       String
  noteId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  note      Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@index([noteId])
}

model NoteSubject {
  id    String @id @default(uuid())
  name  String @unique
  notes Note[]
}

model NoteBoard {
  id    String @id @default(uuid())
  name  String @unique
  notes Note[]
}

model Added {
  id        String   @id @default(uuid())
  userId    String
  noteId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  note      Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@unique([userId, noteId])
  @@index([noteId])
}

model NoteCloudinaryData {
  id            String      @id @default(uuid())
  assetId       String
  playbackId    String?
  publicId      String
  videoUrl      String
  notechapterId String      @unique
  notechapter   NoteChapter @relation(fields: [notechapterId], references: [id], onDelete: Cascade)
}

model NoteUserProgress {
  id            String      @id @default(uuid())
  userId        String
  notechapterId String      @unique
  isCompleted   Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  notechapter   NoteChapter @relation(fields: [notechapterId], references: [id], onDelete: Cascade)

  @@unique([userId, notechapterId])
  @@index([notechapterId])
}

model NoteChapter {
  id               String              @id @default(uuid())
  title            String
  description      String?
  videoUrl         String?
  position         Int
  isPublished      Boolean             @default(false)
  sessionlink      String?
  sessiondate      String?
  sessiontime      String?
  noteId           String
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  videoAssetKey    String?
  note             Note                @relation(fields: [noteId], references: [id], onDelete: Cascade)
  cloudinaryData   NoteCloudinaryData?
  noteuserProgress NoteUserProgress?

  @@index([noteId])
}

model UserModel {
  userId         String   @unique
  name           String
  imageUrl       String
  email          String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  followers      Int      @default(0)
  following      Int      @default(0)
  biog           String
  XP             Int      @default(5)
  id             String   @id @default(uuid())
  followedBy     Follow[] @relation("FollowedBy")
  followingUsers Follow[] @relation("Following")
  tags           Tag[]    @relation("UserTags")
}

model Follow {
  id         String    @id @default(uuid())
  followerId String
  followedId String
  followed   UserModel @relation("FollowedBy", fields: [followedId], references: [id])
  follower   UserModel @relation("Following", fields: [followerId], references: [id])

  @@unique([followerId, followedId])
}

model Tag {
  id    String      @id @default(uuid())
  name  String
  users UserModel[] @relation("UserTags")
}

model Sprint {
  id            String   @id @default(uuid())
  title         String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  imageFullUrl  String
  imageId       String
  imageLinkHTML String
  imageThumbUrl String
  imageUserName String
  orgId         String
  isTemplate    Boolean  @default(false)
  lists         List[]
}

model List {
  id        String   @id @default(uuid())
  title     String
  order     Int
  sprintId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sprint    Sprint   @relation(fields: [sprintId], references: [id], onDelete: Cascade)
  tasks     Task[]

  @@index([sprintId])
}

model Task {
  id          String    @id @default(uuid())
  title       String
  order       Int
  description String?
  listId      String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  dueDate     DateTime?
  list        List      @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model AuditLog {
  id          String      @id @default(uuid())
  orgId       String
  action      ACTION
  entityId    String
  entityType  ENTITY_TYPE
  entityTitle String
  userId      String
  userImage   String
  userName    String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model School {
  id                                  String         @id @default(uuid())
  name                                String
  description                         String?
  imageUrl                            String?
  location                            String?
  website                             String?
  email                               String?
  phone                               String?
  isActive                            Boolean        @default(true)
  createdAt                           DateTime       @default(now())
  updatedAt                           DateTime       @updatedAt
  createdBy                           String
  activeMembers                       Int            @default(0)
  volunteerHours                      Int            @default(0)
  imageAssetId                        String?
  bannerAssetId                       String?
  chapterAdmins                       ChapterAdmin[]
  Assets_School_bannerAssetIdToAssets Assets?        @relation("School_bannerAssetIdToAssets", fields: [bannerAssetId], references: [id])
  Assets_School_imageAssetIdToAssets  Assets?        @relation("School_imageAssetIdToAssets", fields: [imageAssetId], references: [id])
  posts                               SchoolPost[]

  @@index([isActive])
  @@index([createdAt])
  @@index([volunteerHours])
}

model SchoolPost {
  id           String   @id @default(uuid())
  schoolId     String
  title        String
  content      String
  imageUrl     String?
  authorId     String
  authorName   String
  postType     PostType @default(ANNOUNCEMENT)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  imageAssetId String?
  school       School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  imageAsset   Assets?  @relation("SchoolPostImageAsset", fields: [imageAssetId], references: [id])

  @@index([schoolId])
  @@index([isActive])
  @@index([createdAt])
}

model ChapterAdmin {
  id         String           @id @default(uuid())
  userId     String
  schoolId   String
  role       ChapterAdminRole @default(CHAPTER_ADMIN)
  assignedBy String
  isActive   Boolean          @default(true)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  school     School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([userId, schoolId])
  @@index([userId])
  @@index([schoolId])
  @@index([role])
}

model Assets {
  id                                  String       @id
  key                                 String       @unique
  originalName                        String
  mimeType                            String
  size                                Int
  url                                 String
  type                                AssetType
  uploadedBy                          String
  isActive                            Boolean      @default(true)
  createdAt                           DateTime     @default(now())
  updatedAt                           DateTime     @default(now())
  Course                              Course[]
  School_School_bannerAssetIdToAssets School[]     @relation("School_bannerAssetIdToAssets")
  School_School_imageAssetIdToAssets  School[]     @relation("School_imageAssetIdToAssets")
  SchoolPost                          SchoolPost[] @relation("SchoolPostImageAsset")

  @@index([createdAt])
  @@index([key])
  @@index([type])
  @@index([uploadedBy])
}

enum MemberRole {
  ADMIN
  MODERATOR
  GUEST
}

enum ChatType {
  TEXT
  AUDIO
  VIDEO
}

enum TutorRole {
  TUTOR
  SENIOR_TUTOR
  ADMIN_TUTOR
}

enum ACTION {
  CREATE
  UPDATE
  DELETE
}

enum ENTITY_TYPE {
  SPRINT
  LIST
  TASK
}

enum PostType {
  ANNOUNCEMENT
  EVENT
}

enum AssetType {
  SCHOOL_IMAGE
  SCHOOL_BANNER
  COURSE_IMAGE
  POST_IMAGE
  GENERAL_FILE
}

enum ChapterAdminRole {
  CHAPTER_ADMIN
  CHAPTER_SUPER_ADMIN
}
